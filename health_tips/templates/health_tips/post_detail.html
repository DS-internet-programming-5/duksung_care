{% extends 'health_tips/base.html' %}

{% block main_area %}

    <!-- Page content-->
    <div class="container mt-5">
        <div class="row">
            <div class="col-lg-8">
                <!-- Post content-->
                <article>
                    <!-- Post header-->
                    <header class="mb-4">
                        <!-- Post title-->
                        <h1 class="fw-bolder mb-1"> {{ post.post_title }} </h1>

                        {% if post.hook_text %}
                        <h5 class="text-muted"> {{ post.hook_text }} </h5>
                        {% endif %}

                        <!-- Post meta content-->
                        <div class="text-muted fst-italic mb-2">Posted on {{ post.created_at }} </div>

                        <!-- Post update icon -->
                        {% if user.is_authenticated and user == post.author %}
                            <a class="btn btn-info btn-sm fload-end" href="/health_tips/update_post/{{ post.pk }}" role="button">Edit Post</a>
                        {% endif %}

                    </header>
                    <!-- Preview image figure-->
                    <figure class="mb-4"><img class="img-fluid rounded" src="https://dummyimage.com/900x400/ced4da/6c757d.jpg" alt="..." /></figure>
                    <!-- Post content-->
                    <section class="mb-5">
                        <p class="fs-5 mb-4">{{ post.post_content }}</p>
                    </section>
                    <!-- 조회수 표시 -->
                    <p>조회수: {{ post.hits }}</p>
                    <!-- 좋아요 버튼 -->
<form method="post" action="{% url 'post_detail' pk=post.pk %}" id="like-form">
    {% csrf_token %}
    <input type="hidden" name="like_action" id="like-action" value="{% if is_liked %}unlike{% else %}like{% endif %}">
    <button type="submit" class="btn {% if is_liked %}btn-danger{% else %}btn-primary{% endif %}" id="like-button">
        <i class="far fa-thumbs-{% if is_liked %}down{% else %}up{% endif %}"></i>
        {% if is_liked %}Unlike{% else %}Like{% endif %}
    </button>
</form>

<script>

    document.getElementById('like-form').addEventListener('submit', function(event) {
        event.preventDefault();
        var likeActionInput = document.getElementById('like-action');
        var likeButton = document.getElementById('like-button');

        if (likeActionInput.value === 'like') {
            likeActionInput.value = 'unlike';
            likeButton.classList.remove('btn-primary');
            likeButton.classList.add('btn-danger');
            likeButton.innerHTML = '<i class="far fa-thumbs-down"></i> Unlike';
        } else {
            likeActionInput.value = 'like';
            likeButton.classList.remove('btn-danger');
            likeButton.classList.add('btn-primary');
            likeButton.innerHTML = '<i class="far fa-thumbs-up"></i> Like';
        }


    });
</script>


                    <!-- 다운로드 버튼 생성-->
                    {% if post.file_upload %}
                        <a href="{{ post.file_upload.url }}" class="btn btn-outline-dark" role="button" download>Download</a>
                    {% endif %}
                </article>
                <!-- Comments -->
<div id="comment-area">
    <!-- Comments Form -->
    <div class="card my-4">
        <h5 class="card-header">Leave a Comment:</h5>
        <div class="card-body">
            <form>
            	<div class="form-group">
            		<textarea class="form-control" rows=3"></textarea>
            	</div>
            	<button type="submit" class="btn btn-primary">Submit</button>
            </form>
        </div>
    </div>

    <!--  해당 포스트에 댓글이 있다면  -->
    {% if post.comment_set.exists %}
        {% for comment in post.comment_set.iterator %}
            <!-- Single Comment -->
            <div class="media mb-4" id="comment-{{ comment.pk }}">
                <img class="d-flex mr-3 rounded-circle" src="http://placehold.it/50x50" alt="">
                <div class="media-body">
                    <!--"작성자 이름  날짜" 및 내용 출력-->
                    <h5 class="mt-0">{{ comment.author.username }} &nbsp;&nbsp;<small class="text-muted">{{ comment.created_at }}</small>
                    </h5>
                    <p>{{ comment.content | linebreaks }}</p>
                </div>
            </div>
        {% endfor %}
    {% endif %}
</div>
<hr/>

{% endblock %}
        <!-- Footer-->
        <footer class="py-5 bg-dark">
            <div class="container"><p class="m-0 text-center text-white">Copyright &copy; Your Website 2023</p></div>
        </footer>
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="js/scripts.js"></script>
